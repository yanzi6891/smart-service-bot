# smart-service-bot 应用配置

spring:
  application:
    name: smart-service-bot

  profiles:
#    active: @spring.profiles.active@
    active: dev

  # 数据源配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${MYSQL_HOST:localhost}:${MYSQL_PORT:3306}/${MYSQL_DATABASE:smart_service_bot}?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: ${MYSQL_USERNAME:root}
    password: ${MYSQL_PASSWORD:123456}
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      auto-commit: true
      idle-timeout: 30000
      pool-name: SmartBotHikariCP
      max-lifetime: 1800000
      connection-timeout: 30000

  # Redis配置
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    database: 0
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
        max-wait: -1ms
    timeout: 3000ms

  # Jackson配置
  jackson:
    time-zone: Asia/Shanghai
    date-format: yyyy-MM-dd HH:mm:ss
    serialization:
      write-dates-as-timestamps: false

  # 文件上传配置
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 50MB

# 服务器配置
server:
  port: 8080
  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      enabled: true
      force: true

# MyBatis Plus配置
mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  type-aliases-package: com.smartbot.domain.entity
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: true
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# Sa-Token配置
sa-token:
  token-name: Authorization
  token-prefix: Bearer
  timeout: 7200
  active-timeout: -1
  is-concurrent: true
  is-share: false
  token-style: uuid
  is-log: false

# Knife4j API文档配置
knife4j:
  enable: true
  setting:
    language: zh_cn
  openapi:
    title: smart-service-bot API文档
    description: 企业级智能AI客服系统接口文档
    version: v1.0.0
    contact:
      name: SmartBot Team
      email: support@smartservicebot.com
    group:
      default:
        group-name: 默认分组
        api-rule: package
        api-rule-resources:
          - com.smartbot.controller

# AI模型配置
ai:
  # 默认提供商: OPENAI | TONGYI | WENXIN
  default-provider: OPENAI

  # OpenAI配置
  openai:
    api-key: ${OPENAI_API_KEY:}
    base-url: ${OPENAI_BASE_URL:https://api.openai.com/v1}
    model: gpt-4
    temperature: 0.7
    max-tokens: 2000
    timeout: 30s

  # 通义千问配置
  tongyi:
    api-key: ${TONGYI_API_KEY:}
    model: qwen-turbo

  # 向量化配置
  embedding:
    model: text-embedding-ada-002
    dimensions: 1536
    batch-size: 100

# Milvus向量数据库配置
milvus:
  host: ${MILVUS_HOST:localhost}
  port: ${MILVUS_PORT:19530}
  database: default
  collection-name: knowledge_vectors
  index-type: IVF_FLAT
  metric-type: COSINE
  nlist: 1024

# 知识库配置
knowledge:
  # 文档上传配置
  upload:
    max-file-size: 10485760  # 10MB
    allowed-types: pdf,doc,docx,txt,md
    storage-path: ${STORAGE_PATH:/data/documents}

  # 分块配置
  chunk:
    size: 500              # 每块字符数
    overlap: 50            # 重叠字符数
    enable-ocr: false      # 是否启用OCR

  # RAG检索配置
  rag:
    top-k: 5               # 返回Top-K结果
    similarity-threshold: 0.7  # 相似度阈值
    rerank: true           # 是否重排序

# 缓存配置
cache:
  # L1缓存 (Caffeine)
  caffeine:
    context:
      expire-after-write: 30m
      maximum-size: 10000
    knowledge:
      expire-after-write: 1h
      maximum-size: 5000

  # L2缓存 (Redis)
  redis:
    context:
      ttl: 30m
    knowledge:
      ttl: 24h

# 日志配置
logging:
  level:
    root: INFO
    com.smartbot: DEBUG
    org.springframework.web: INFO
    org.springframework.ai: DEBUG
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{50} - %msg%n'
    file: '%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{50} - %msg%n'
  file:
    name: logs/smart-service-bot.log
    max-size: 100MB
    max-history: 30

# Actuator监控配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true
